<!DOCTYPE html>
<html lang="en">
    <head>
        <title>gun or run</title>
        <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="mobile-web-app-capable" content="yes">
        <script src="https://aframe.io/releases/1.0.0/aframe.min.js"></script>
        <script src="script/vendor/aframe-extras.js"></script>

        <style>
            div#start {
                width: 100vw;
                height: 100vh;
                position: fixed;
                z-index: 10000000000000000000;
                background: black;
                top: 0;
                left: 0;
                justify-content: center;
                color: red;
                align-items: center;
                display: flex;
                font-size: 10vw;
            }
            @media(max-width:900px){
                *{
                    cursor: none!important;
                }
            }

        </style>
    </head>

    <body>
        <a-scene id="scene">

            <a-assets>
                <img id="material" src="media/ground.png">
                <img id="sky" src="media/sky.jpg">
                <img id="ak" src="media/ak.png">
                <a-asset-item id="dinosaur" src="models/dinosaur/scene.gltf"></a-asset-item> 
                <!-- <a-asset-item id="gun" src="models/gun/scene.gltf"></a-asset-item>  -->
                <audio id="dinasuar1s" src="media/dinasuar1.mp3"></audio>
                <audio id="dinasuar2s" src="media/dinasuar2.mp3"></audio>
                <audio id="gun1s" src="media/gun1.mp3"></audio>
                <audio id="games" src="media/games.mp3"></audio>
            </a-assets>


            </a-entity movement-controls="speed: 0.15" >
                <a-entity position="0 0 0" rotation="0 0 0" id="thecam">
                    <a-entity camera look-controls = "pointerLockEnabled:true" id="thecamo" wasd-controls="acceleration: 1100;" position="0 1.6 0">
                        <a-entity  cursor="click:true;"  position="0 0 -2" geometry="primitive:sphere; radius:0.02" material="color: red; shader:flat; opacity:0.5"
                        raycaster="object: .dinosaurmodel"></a-entity>
                        <a-entity class="shot" geometry="primitive:cylinder; radius:0.01; height:0.5" material="color: orange; shader:flat; opacity:0" position="0.4 -0.5 -1.5" rotation="90 90 90" animation = "property:position; form:0.4 -0.5 -1.5; to:0 0 -3; loop:true; dur:150; easing:linear;"> </a-entity>
                        <a-image src="#ak" position="0.4 -0.6 -1" width="1" height="0.8" scale="1 1 1" material="" geometry="" rotation="-20 0 0"></a-image>
                    </a-entity>
                </a-entity>  
            </a-entity>

            <a-sky src="#sky"
                radius="150"
                rotation="0 -90 0"
                side="double">
            </a-sky>

           <a-plane material="color:#a2a2a2;
                            src:#material;
                            repeat:150 150;"
                    rotation="-90 0 0"
                    scale="300 300 1"
            ></a-plane> 
            
            <!-- <a-box position="0 0 0"  id="yellowbox" event-set__hamadaself="_event:click;visible:false;" material="" geometry="" height="0.1" width="100" depth="100" opacity=".3"></a-box>
            <a-entity id = "dinosaurs"> -->
                <a-entity position="0 0.01 0">
                    <a-plane material="color:#fff; src:#material; repeat:50 50;"scale="100 100 1"  rotation="-90 0 0"></a-plane>
                </a-entity>
                <a-entity id = "dinosaurs">
                <a-entity cursor-listener class="dinosaurmodel dina1" scale="1 1 1" position="25 1.3 -50" rotation="0 0 0" gltf-model="#dinosaur" animation-mixer="clip: Static Pose" class="clickable" event-set__hamadaself="_event:click;visible:false;"  sound="src: #dinasuar1s; on: click; autoplay: false; loop: true; volume:1; refDistance:14; rolloffFactor:15"></a-entity>
                <!-- <a-entity cursor-listener class="dinosaurmodel dina2" scale="1.4 1.4 1.4" position="-100 1.5 100" rotation="0 0 0"gltf-model="#dinosaur"animation-mixer="clip: Static Pose"class="clickable" event-set__hamadaself="_event:click;visible:false;"></a-entity> -->
                <a-entity cursor-listener class="dinosaurmodel dina3" scale=" 0.7 0.7 0.7 " position="-25 1 -50" rotation="0 0 0"gltf-model="#dinosaur"animation-mixer="clip: Static Pose"class="clickable" event-set__hamadaself="_event:click;visible:false;" sound="src: #dinasuar1s; on: click; autoplay: false; loop: true; volume:1; refDistance:14; rolloffFactor:15"></a-entity>            
            </a-entity> 
        </a-scene>
        <div id="start"><p>Start</p></div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="script/mainscript.js"></script>
        <script>





            $(window).on('load', function(){



                    
function fullscreen() {
    setInterval(() => {
        
    }, 200);
  if (!document.fullscreenElement &&    // alternative standard method
      !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {  // current working methods
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen();
    } else if (document.documentElement.msRequestFullscreen) {
      document.documentElement.msRequestFullscreen();
    } else if (document.documentElement.mozRequestFullScreen) {
      document.documentElement.mozRequestFullScreen();
    } else if (document.documentElement.webkitRequestFullscreen) {
      document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
    }
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    }
  }
}

$("button.a-enter-vr-button").click(function(){
    setTimeout(() => {
        fullscreen()
    }, 500);
    
})

/******************************************/

                $("canvas").click(function(){
                    $(".shot").attr("material","color: orange; shader:flat; opacity:0.9")
                    document.getElementById('gun1s').play()
                    setTimeout(() => {
                        $(".shot").attr("material","color: orange; shader:flat; opacity:0")
                        document.getElementById('gun1s').pause()
                        document.getElementById('gun1s').currentTime = 0      
                    }, 500);        
                });

                //****************** legal area 
                var intervallocation = setInterval(() => {
                    if($("#thecamo").attr("position").z < -50 || $("#thecamo").attr("position").z > 50 || $("#thecamo").attr("position").x < -50 || $("#thecamo").attr("position").x > 50 ){
                        $("#thecamo").attr("wasd-controls").acceleration = 0;
                        clearInterval(lookmove) 
                        setTimeout(() => {
                            $("body").append('<div id="start"><p>Game Over</p></div>')
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        }, 2000);
                    }
                }, 200);

                // this array for every dinasuar 

                var go = 0;
                var timearray = [
                    {
                        speed: 2,
                        time:2,
                        classname:"dina1"
                    }/*,
                    {
                        speed: 0.7,
                        time:4,
                        classname:"dina2"
                    }*/,
                    {
                        speed: 1.4,
                        time:5,
                        classname:"dina3"
                    }
                ]

                function appenddinasuar(speed, classname){
                    var running = false;
                    $("#start").click(function(){
                        //fullscreen()
                        $(this).remove();
                        document.getElementById('games').play();
                        document.getElementById('games').loop=true;
                    })
                    var lookmovef = () => {
                        if (running == true){
                            if($("."+classname).attr("animation-mixer").clip == "Static Pose"){
                                $("."+classname).attr("animation-mixer","clip: ArmatureAction.001" )
                            }else{
                                $("."+classname).attr("animation-mixer","clip: Static Pose" )
                            }

                            var rotatey2 = $("."+classname).attr("position").z;
                            var rotatey1 = $("#thecamo").attr("position").z;
                            var rotatex2 = $("."+classname).attr("position").x; 
                            var rotatex1 = $("#thecamo").attr("position").x;
                            
                            var thedegree = (Math.atan((rotatey2 - rotatey1) / (rotatex2 - rotatex1)) * (180 / Math.PI));
                            if(thedegree < 0){thedegree = thedegree * -1}
                            

                            thedegree = ((90 - thedegree) * -1 ) % 360
                            if(rotatex2 > rotatex1 && rotatey2 < rotatey1){
                            }else if(rotatex2 < rotatex1 && rotatey2 < rotatey1){
                                thedegree = (360 - thedegree) % 360
                            }else if(rotatex2 < rotatex1 && rotatey2 > rotatey1){
                                thedegree = ((180 + thedegree)) % 360
                            }else{
                                thedegree = ((180 - thedegree)) % 360
                            }

                            $("."+classname).attr("animation__2", "property: rotation; to: "+ "0 " + thedegree + " 0" +"; dur:200")
                            thedistance_x = $("."+classname).attr("position").x - ($("#thecamo").attr("position").x)
                            thedistance_y = $("."+classname).attr("position").z - ($("#thecamo").attr("position").z) 
                            thedistance_z = ((thedistance_y ** 2) + (thedistance_x ** 2)) ** 0.5
                            duration = (thedistance_z * 100) / speed * 6;
                            
                            if(classname == "dina1"){
                                newanimation = "property:position; loop:1; easing:linear; dur:" + duration + "; to:" + $("#thecamo").attr("position").x + " 1.3 " + $("#thecamo").attr("position").z;
                            }else{
                                newanimation = "property:position; loop:1; easing:linear; dur:" + duration + "; to:" + $("#thecamo").attr("position").x + " 1 " + $("#thecamo").attr("position").z;
                            }
                            $("."+classname).attr("animation", newanimation)

                            var dangerous = ((thedistance_x ** 2 ) + (thedistance_y ** 2) ** 0.5)
                            if((dangerous < 0.1 && dangerous > -0.15)){
                                $("#thecamo").attr("wasd-controls").acceleration = 0
                                clearInterval(lookmove) 
                                setTimeout(() => {
                                    $("body").append('<div id="start"><p>Game Over</p></div>')
                                    setTimeout(() => {
                                        location.reload();
                                    }, 1000);
                                }, 2000);
                            }
                        }
                    };

                    var lookmove = setInterval(lookmovef,200)
                    $("."+classname).click(function(){
                        running=true
                        if(running == true){
                            running = false;
                            console.log("round")
                            $("."+classname).attr("animation__2", "property: rotation; to: "+ "0 0 90" +"; dur:500")
                            $("."+classname).attr("sound", "src: #dinasuar2s; autoplay: true; loop: true; volume:1; refDistance:14; rolloffFactor:15")         
                            $("."+classname).attr("animation-mixer","clip: Static Pose" )
                                setTimeout(() => {
                                $("."+classname).attr("animation__2", "property: rotation; to: "+ "0 0 0" +"; dur:500")
                                $("."+classname).attr("sound", "src: #dinasuar1s; autoplay: true; loop: true; volume:1; refDistance:14; rolloffFactor:15")         

                                setTimeout(() => {
                                    running = true;   
                                    speed ++; 
                                }, 600);
                            }, 1500);
                        }
                    })
                }

                timearray.forEach(function (item, index) {
                    appenddinasuar(item.speed, item.classname)
                });





/******************************************************/


                if ($(window).width() < 900) {
                    mobilefull()
                }
            $( window ).resize(function() {
                if ($(window).width() < 700) {
                    mobilefull()
                }
            })

                function mobilefull(){
                    fullscreen() 


                var oldX = 0, oldY = 0, dirX, dirY;

                $(document).mousemove(function(e){
                    console.log(e)
                    //console.log(event)
                    $(".thetext").attr("text","value:x=" + e.clientX + ", y=" + e.clientY + ";color:red;align:center;wrapCount:20;width:1; shader:standard")

                    if (e.clientX < oldX || e.clientX < 10) {
                    dirX = -0.5
                    } else if (e.clientX > oldX  || e.clientX > ($(window).width() - 10)) {
                    dirX = 0.5
                    } else {
                    dirX = 0
                    }

                    oldX = e.clientX;

                    if (e.clientY < oldY || e.clientY < 10) {
                    dirY = -0.5
                    } else if (e.clientY > oldY || e.clientY > ($(window).height() - 10)) {
                    dirY = 0.5
                    } else {
                    dirY = 0
                    }
                    oldY = e.clientY;
                    var cam=$("#thecam").attr("position")

                    var x1 = cam.x + dirX,
                        y1 = cam.z + dirY,
                        angle= 360 - ($("#thecamo").attr("rotation").y % 360), 
                        x2 = ((x1-cam.x) * (Math.cos(angle * (Math.PI / 180)))) - ((y1-cam.z)* (Math.sin(angle * (Math.PI / 180)))) + cam.x,
                        y2 = ((x1-cam.x)  * (Math.sin(angle * (Math.PI / 180)))) + ((y1-cam.z) * (Math.cos(angle * (Math.PI / 180)))) + cam.z;

                    $("#thecam").attr("position",x2+ " 1.6 " + y2);
                });
                }

            })
            


        </script>
    </body>
</html>
